{% extends "base.html" %}

{% block title %}Edit Flow{% endblock %}

{% block content %}
<div class="container">
    <h2>Edit Flow</h2>
    <div style="margin-bottom: 1em;">
        <a href="{{ url_for('flows') }}" class="btn">‚Üê Back to Flows</a>
    </div>
    <form method="post">
        <div class="form-group">
            <label>ID</label>
            <input type="text" name="id" class="form-control" value="{{ flow_info.get('id', '') }}" required>
        </div>
        <div class="form-group">
            <label>Priority</label>
            <input type="number" name="priority" class="form-control" value="{{ flow_info.get('priority', '') }}" required>
        </div>
        <div class="form-group">
            <label>Table ID</label>
            <input type="number" name="table_id" class="form-control" value="{{ flow_info.get('table_id', '') }}" required>
        </div>

        <h4>Match Fields</h4>
        <div class="form-group">
            <label>in_port</label>
            <input type="text" name="match_in_port" class="form-control"
                   value="{{ flow_info.get('match', {}).get('in_port', '') }}">
        </div>
        <div class="form-group">
            <label>eth_type</label>
            <input type="text" name="match_eth_type" class="form-control"
                   value="{{ flow_info.get('match', {}).get('ethernet_match', {}).get('ethernet_type', {}).get('type', '') }}">
        </div>
        <div class="form-group">
            <label>ipv4_src</label>
            <input type="text" name="match_ipv4_src" class="form-control"
                   value="{{ flow_info.get('match', {}).get('ipv4_source', '') }}">
        </div>
        <div class="form-group">
            <label>ipv4_dst</label>
            <input type="text" name="match_ipv4_dst" class="form-control"
                   value="{{ flow_info.get('match', {}).get('ipv4_destination', '') }}">
        </div>

        <hr>

        <h4>Instructions / Actions</h4>
        <div class="form-group">
            <label>Output Port</label>
            <input type="text" name="action_output" class="form-control"
                   value="{% for inst in flow_info.get('instructions', []) %}
                              {% for act in inst.get('apply_actions', []) %}
                                  {% if act.get('output_action') %}
                                      {{ act.get('output_action').get('output_node_connector', '') }}
                                  {% endif %}
                              {% endfor %}
                          {% endfor %}">
        </div>
        <div class="form-group">
            <label>Drop</label>
            <input type="checkbox" name="action_drop"
                   {% for inst in flow_info.get('instructions', []) %}
                       {% for act in inst.get('apply_actions', []) %}
                           {% if act.get('drop_action') %}checked{% endif %}
                       {% endfor %}
                   {% endfor %}>
        </div>
        <div class="form-group">
            <label>Set Field (IPv4 Src)</label>
            <input type="text" name="action_set_ipv4_src" class="form-control"
                   value="{% for inst in flow_info.get('instructions', []) %}
                              {% for act in inst.get('apply_actions', []) %}
                                  {% if act.get('set_field') and act.set_field.get('ipv4_source') %}
                                      {{ act.set_field.get('ipv4_source') }}
                                  {% endif %}
                              {% endfor %}
                          {% endfor %}">
        </div>

        <hr>

        <button type="submit" class="btn btn-primary">Save</button>
    </form>
</div>
{% endblock %}
